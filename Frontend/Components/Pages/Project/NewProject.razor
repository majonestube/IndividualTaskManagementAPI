@page "/NewProject"
@using Frontend.Components.Layout
@using Frontend.Services
@using MyShared.Models
@rendermode InteractiveServer
@inject NavigationManager Navigation
@inject JwtHelper JwtHelper
@layout AfterLoginLayout

<h3>New Project</h3>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <p style="color:red">@errorMessage</p>
}
<input @bind="project.Name" placeholder="Project Name"/>
<br/>
<textarea @bind="project.Description" placeholder="Project Description"></textarea>
<br/>
<button @onclick="CreateProject">Create Project</button>

@code {
    private ProjectCreateDto project = new();
    private string? errorMessage;

    private async Task CreateProject()
    {
        // check that requried fields are not empty
        errorMessage = string.Empty;

        if (string.IsNullOrWhiteSpace(project.Name))
        {
            errorMessage = "Project name is required";
            return;
        }
        
        // create the project 
        try
        {
            var client = await JwtHelper.GetAuthenticatedClientAsync();
            var response = await client.PostAsJsonAsync("api/project", project);

            if (!response.IsSuccessStatusCode)
            {
                errorMessage = "Error creating project.";
                Console.WriteLine(response);
                return;
            }

            Navigation.NavigateTo("/");
        }
        catch (Exception ex)
        {
            errorMessage = "Exception: " + ex.Message;
        }
        
    } 
}